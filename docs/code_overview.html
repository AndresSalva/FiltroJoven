<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Guia del Codigo - FiltroJoven</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; line-height: 1.6; color: #222; }
    h1, h2, h3 { color: #1a4a6a; }
    code { background: #f4f4f4; padding: 0.15rem 0.3rem; border-radius: 4px; }
    pre { background: #f4f4f4; padding: 1rem; border-radius: 6px; overflow-x: auto; }
    ul { margin-left: 1.5rem; }
  </style>
</head>
<body>
  <h1>Guia del Codigo - FiltroJoven</h1>
  <p>Este documento resume los modulos principales del proyecto FiltroJoven y explica como interactuan para aplicar un filtro de rejuvenecimiento facial mediante algoritmos geneticos.</p>

  <h2>1. Punto de entrada (<code>main.py</code>)</h2>
  <ul>
    <li>Interfaz de linea de comandos para una corrida unica del algoritmo genetico.</li>
    <li>Argumentos clave: <code>--image</code>, <code>--output-dir</code>, <code>--gens</code>, <code>--pop</code>, <code>--fitness</code>, <code>--selection</code>, <code>--crossover</code>, <code>--mutation</code>, <code>--seed</code>.</li>
    <li><code>utils.image_utils.load_image</code> valida y carga la fotografia.</li>
    <li>Mapea nombres legibles a funciones en <code>ga/</code> para fitness, seleccion, cruce y mutacion.</li>
    <li>Llama a <code>run_genetic_algorithm</code> y guarda el resultado en <code>output_images/</code>.</li>
  </ul>

  <h2>2. Transformaciones y algoritmo genetico (<code>transformations/face_manipulator.py</code>)</h2>
  <h3>2.1 Mascaras faciales</h3>
  <p><code>compute_masks</code> genera <code>skin_mask</code>, <code>keep_mask</code> y <code>feathered_mask</code> para controlar donde se aplican los filtros.</p>

  <h3>2.2 Transformacion parametrizada</h3>
  <p><code>apply_transformation</code> ejecuta suavizado bilateral, correccion gamma y unsharp masking selectivo. Los limites de los parametros estan definidos en <code>PARAM_BOUNDS</code>.</p>

  <h3>2.3 Motor genetico</h3>
  <ul>
    <li><code>run_genetic_algorithm</code> inicializa poblacion, aplica elitismo y ejecuta seleccion, cruce y mutacion durante <code>iters</code> generaciones.</li>
    <li><code>sample_params</code> toma valores aleatorios respetando los limites declarados.</li>
    <li><code>_evaluate_candidate</code> aplica la transformacion y calcula fitness, historiales y diversidad.</li>
    <li><code>_population_diversity</code> mide la dispersion promedio de los parametros.</li>
  </ul>

  <h2>3. Operadores y funciones de aptitud (<code>ga/</code>)</h2>
  <h3>3.1 Fitness</h3>
  <p><code>ga/fitness_functions.py</code> define <code>original</code>, <code>ideal</code>, <code>color</code> y combinaciones ponderadas mediante <code>WeightedCompositeFitness</code>. <code>get_tracked_fitness</code> agrega registro de metricas.</p>

  <h3>3.2 Seleccion</h3>
  <p><code>ga/selection_operators.py</code> incluye torneo, ruleta, ranking y SUS.</p>

  <h3>3.3 Cruce</h3>
  <p><code>ga/crossover_operators.py</code> implementa cruces de punto unico, dos puntos, k puntos y uniforme sobre diccionarios de parametros.</p>

  <h3>3.4 Mutacion</h3>
  <p><code>ga/mutation_operators.py</code> aplica ruido gaussiano y usa <code>clip_params</code> para mantener los limites.</p>

  <h2>4. Benchmark experimental (<code>experiments/benchmark.py</code>)</h2>
  <ul>
    <li>Registros de configuracion: <code>FITNESS_SPEC_REGISTRY</code>, <code>SELECTION_REGISTRY</code>, <code>CROSSOVER_REGISTRY</code>, <code>MUTATION_REGISTRY</code>.</li>
    <li>Distribuye tareas con <code>ThreadPoolExecutor</code> usando semillas derivadas de <code>base_seed</code>.</li>
    <li>Genera CSV: <code>ga_benchmark_runs.csv</code>, <code>ga_benchmark_summary.csv</code>, <code>ga_benchmark_history.csv</code>.</li>
    <li>Produce figuras: <code>fitness_boxplot_cdf.png</code>, <code>heatmap_&lt;fitness&gt;_cdf.png</code>, <code>convergence_&lt;fitness&gt;_cdf.png</code>, <code>convergence_all_cdf.png</code>, <code>diversity_&lt;fitness&gt;.png</code>.</li>
    <li><code>generate_report</code> crea <code>benchmark_report.md</code> con tablas y rutas relativas a las figuras.</li>
  </ul>

  <h2>5. Utilidades de soporte</h2>
  <ul>
    <li><code>utils/image_utils.py</code>: carga, guardado, conversiones y escalado de imagenes.</li>
    <li><code>utils/metrics.py</code>: SSIM, Laplaciano, contadores de bordes y energia de textura.</li>
    <li><code>utils/display_utils.py</code>: herramientas para visualizar comparaciones.</li>
    <li><code>core/haar_detector.py</code>: deteccion de rostro con Haar cascades y mascaras base.</li>
  </ul>

  <h2>6. Flujo resumido de ejecucion</h2>
  <ol>
    <li>Carga de imagen y calculo de mascaras.</li>
    <li>Inicializacion de la poblacion con <code>sample_params</code>.</li>
    <li>Evaluacion y evolucion del algoritmo genetico.</li>
    <li>Guardado de la mejor imagen y registro de metricas.</li>
    <li>Integracion con el benchmark para generar CSV, figuras y reportes.</li>
  </ol>

  <p>Con esta guia puedes ubicar rapidamente las funciones relevantes, comprender el flujo de datos y extender el proyecto de forma coherente con la organizacion actual del repositorio.</p>
</body>
</html>
